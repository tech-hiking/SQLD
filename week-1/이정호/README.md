# PART 2 | SQL 기본 및 활용

## CHAPTER 1 | SQL 기본 (77~151p)

### 1) 관계형 데이터베이스 개요
- 복잡한 SQL은 어떻게 작성하느냐에 따라 성능 차가 확연히 드러나기 때문에 SQL을 잘 작성하고 튜닝하는 것이 매우 중요하다.


### 2) SELECT 문
- SELECT *(asterisk)를 쓸때 조회되는 컬럼의 순서는 테이블 컬럼 순서와 동일하다.
- Alias를 붙일 때는 앞에 AS를 넣어도 되고 넣지 않아도 된다.
- 다른 컬럼끼리의 연산에 NULL이 포함되어 있는 경우 결과값은 NULL이 된다.
- 나머지 연산자(%)는 우선순위 3순위(+/- 와 동일순위)
- 문자와 문자를 연결할 때 사용하는 합성 연산자: ||


### 3) 함수
- LTRIM('블랙핑크', '블랙') --> 핑크
  - 특정문자를 명시해주었을 경우 문자열을 왼쪽부터 한 글자씩 특정 문자와 비교하여 특정 문자에 포함돼있으면 제거하고 포함되지 않았으면 멈춘다.
    - LTRIN('DATABASE', 'DE') --> ATABASE
- TRIM(LEADING '블' FROM '블랙핑크') --> 랙핑크
  - 옵션이 있을 경우 지정된 곳부터 한 글자씩 특정 문자(한 글자만 지정 가능)와 비교하여 제거하고 같지 않으면 멈춘다.
- SUBSTR(문자열, 시작점 [,길이])
  - 길이를 명시하지 않았을 경우 문자열의 시작점부터 문자열의 끝까지 반환된다.
  - SUBSTR('블랙핑크제니', 3, 2) --> 핑크
- REPLACE(문자열, 변경 전 문자열 [,변경 후 문자열])
- LPAD(문자열, 길이, 문자)
  - 문자열이 설정한 길이가 될 떄까지 왼쪽을 특정 문자로 채우는 함수이다.
  - LPAD('JENNIE', 10, 'V') --> VVVVJENNIE
- SIGN(수)
  - 수의 부호를 반환해주는 함수이다. 양수이면 1, 음수이면 -1, 0이면 0을 반환한다.
- ROUND(수 [,자릿수])
  - 수를 지정된 소수점 자릿수까지 반올림하여 반환해주는 함수이다. 자릿수를 명시하지 않으면 기본값은 0 이며 정수로 반환하고, 자릿수가 음수일 경우 지정된 정수부를 반올림하여 반환한다.
  - ROUND(163.76, -2) --> 200
- TRUNC
  - 수를 지정된 소수점 자릿수까지 버림하여 반환해주는 함수이다. 자릿수를 명시하지 않으면 기본값은 0 이며 버림된 정수로 반환하고, 자릿수가 음수일 경우 지정된 정수부에서 버림하여 반환한다.
- CEIL(수)
  - 소수점 이하의 수를 올림한 정수를 반환해주는 함수이다.
  - CEIL(72.86) --> 73
  - CEIL(-33.4) --> -33
- FLOOR(수)
  - 소수점 이하의 수를 버림한 정수를 반환해주는 함수이다.
  - FLLOR(-22.3) --> -23
- MOD(수1, 수2)
  - 수1을 수2로 나눈 나머지를 반환해주는 함수이다. 단 수2가 0일겨웅 수1을 반환한다.
  - MOD(15, -4) --> 3
    - *몫은 양수 나눗셈 기준으로 부호만 맞추어주면 되고, (나누는 두 수의 부호가 같으면 몫이 양수, 다르면 몫이 음수) 나머지는 위에서 구한 몫으로, a=bq+r 를 만족하는 값이 된다.
- SYSDATE --> 2021-09-21 22:08:08
- EXTRACT(MONTH FROM SYSDATE) --> 9
- ADD_MONTHS(날짜 데이터, 특정 개월 수)
  - 날짜 데이터에서 특정 개월 수를 더한 날짜를 반환해주는 함수이다. 날짜의 이전 달이나 다음 달에 기준 날짜의 일자가 존재하지 않으면 해당 월의 마지막 일자가 반환된다.
  - ADD_MONTHS(TO_DATE('2021-12-31', 'YYYY-MM-DD'), -1) --> 2021-11-30
- TO_NUMBER(문자열)
  - 문자열을 숫자형으로 변환해주는 함수이다.
  - TO_NUMBER('abc') --> Error 발생
- TO_CHAR(수 or 날짜 [,포맷])
  - 수나 날짜형의 데이터를 포맷 형식의 문자형으로 변환해주는 함수이다.
  - TO_CHAR(SYSDATE, 'YYYYMMDD HH24MISS') --> 20210921 223321
- TO_DATE(무낮열, 포맷)
  - 포맷 형식의 문자형 데이터를 날짜형으로 변환해주는 함수이다.
  - HH: 시(12), HH24: 시(24)
  - MI: 분
- NVL(인수1, 인수2)
  - 인수1의 값이 NULL일 경우 인수2를 반환하고, 아닐경우 인수1을 반환해주는 함수이다.
- NVL2(인수1, 인수2, 인수3)
  - 인수1이 NULL이 아닌 경우 인수2를 반환하고, NULL인 경우 인수3을 반환하는 함수이다.
- NULLIF(인수1, 인수2)
  - 인수1과 인수2가 같으면 NULL을 반환하고 같지 않으면 인수1을 반환해주는 함수이다.
- COALESCE(인수1, 인수2, 인수3 ...)
  - NUL이 아닌 최초의 인수를 반환해주는 함수이다.
- CASE(=DECODE) 문에서는 ELSE 뒤의 값이 DEFAULT 값이 되고 별도의 ELSE가 없을 경우 NULL 값이 DEFAULT 값이 된다.


### 4) WHERE 절
- !=, ^=, <>, not 컬럼명 =
  - 같지 않음
- NULL과의 연산 결과는 항상 NULL이다.
  - NULL이 아닌 행을 조회할 때는 IS NOT NULL 구문을 사용한다.
- 조건식에서 컬럼명은 우측에 위치해도 정상으로 동작한다.
- LIKE '비교 문자열'
  - % 문자열
  - _ 하나의 문자
  - % 혹은 _ 기호가 포함된 문자 검색 시 ESCAPE 지정
    - where col like '%#%%' escape '#'
    - escape기호는 취향대로 정의할 수 있다.
- BETWEEN은 포함
- 논리 연산자 처리 순서
  - () -> NOT -> AND -> OR


### 5) GROUP BY, HAVING 절
- HAVING 절은 논리적으로 GROUP BY 절 이후에 수행되기 때문에 그룹핑 후에 가능한 집계 함수로 조건을 부여할 수 있다.
- HAVING 절은 논리적으로 SELECT 절 전에 수행되기 때문에 SELECT 절에 명시되지 않은 집계 함수로도 조건을 부여할 수 있다.
- WHERE 절을 사용해도 되는 조건까지 HAVING 절로 써버리면 성능상 불리할 수 있다.(수행 시 오류가 나진 않음)


### 6) ORDER BY 절
- 옵션 생략 시 ASC(오름차순)가 기본값이 된다.
- 정렬의 기준이 되는 컬럼에 NULL 데이터가 포함되어 있을 경우 Oracle의 경우 NULL을 최댓값으로 취급한다.(DBMS마다 다르다)
  - NULLS FIRST, NULLS LAST 옵션을 써서 정렬상 순서를 변경할 수 있다.
- 쿼리의 논리적 실행 순서: FROM -> WHERE -> GROUP BY -> HAVING -> SELECT -> ORDER BY


### 7) JOIN
- OUTER JOIN은 JOIN 조건에 만족하지 않는 행들도 출력되는 형태이다.
  - Oracle에서는 모든 행이 출력되는 테이블의 **반대편** 테이블의 옆에 (+) 기호를 붙여 작성해주면 된다.
    - WHERE A.PRODUCT_CODE = B.PRODUCT_CODE(+);
    - 기호를 좌변이나 우변 중 하나에만 표기해야 한다.


### 8) STANDARD JOIN
- ANSI JOIN, 표준 조인이라는 말로 많이 쓰인다.
- NATURAL JOIN
  - A 테이블과 B 테이블에서 같은 이름을 가진 컬럼들이 모두 동일한 데이터를 가지고 있을 경우 JOIN이 되는 방식이다.
  - ON 절을 쓸 수 없다.
- Oracle에서는 USING 조건절을 이용하여 원하는 컬럼만 JOIN에 이용할 수 있다.
  - 단, SELECT 절에서 USING 절로 정의된 컬럼 앞에는 별도의 ALIAS나 테이블명을 붙이지 않아야 한다.
- CROSS JOIN: 경우의 수 처럼 조합할 수 있는 모든 경우를 출력하는 방식이다. 별도의 JOIN 조건이 없는 경우 이것으로 나타낸다.


### 적중예상문제
- 2번
  - NULL과의 연산 결과는 False
- 4번
  - DECODE 문에서는 인수 개수가 짝수일 때 마지막 값이 DEFAULT 값이 된다. '' 는 NULL과 다름
- 7번
  - NATURAL JOIN은 공통 컬럼 앞에 ALIAS를 붙이면 에러가 발생한다.
- 9번
  - NULL 값을 가장 큰값으로 정할지 여부는 DBMS마다 다르다.
- 20번
  - CHAR 데이터 타입은 고정길이를 가지고 있기에 나머지 자리는 공백으로 채워서 고정길이를 유지한다.
- 24번
  - ALIAS를 별도로 지정해주지 않으면 컬럼명이 대문자로 출력된다.(즉 alias쓰면 소문자도 가능)
- 25번
  - ORDER BY 절에는 컬럼명을 명시해줄 수도 있고 SELECT 절에 기술된 컬럼의 순서를 숫자로 명시해줄 수도 있다.
- 27번
  - AVG, MAX는 각각 NULL값을 제외하고 계산한다.
- 28번
  - 테이블 전체가 한 개의 그룹이 되는 경우 HAVING만 단독으로 사용할 수 있다.
- 30번
  - Oracle에서는 모든 행이 출력되는 테이블의 **반대편** 테이블의 옆에 (+) 기호를 붙여 작성해주면 된다.
